{
  "name": "RegistrationPipeline",
  "components": [
    {
      "desc": "Add registration emails to the context, for later build",
      "type": "AddContextEmails",
      "events": {
        "fail": "AddContextEmailsFailEvent",
        "success": "AddContextEmailsNextEvent"
      },
      "handlers": {
        "fail": "ResponseHandler",
        "success": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Transform the User viewmodel into the User domain model",
      "type": "TransformViewModelToDomain",
      "events": {
        "fail": "TransformViewModelToDomainFailEvent",
        "success": "TransformViewModelToDomainNextEvent"
      },
      "handlers": {
        "fail": "ResponseHandler",
        "success": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Ensure that the email is not already in the database",
      "type": "EnforceUniqueUserEmail",
      "events": {
        "fail": "EnforceUniqueUserEmailFailEvent",
        "success": "EnforceUniqueUserEmailNextEvent"
      },
      "handlers": {
        "fail": "ResponseHandler",
        "success": "NextHandler"
      },
      "responders": {
        "fail": "Responder409"
      }
    },
    {
      "desc": "Convert the user's cleartext password to encrypted",
      "type": "TransformUserClearPassword",
      "events": {
        "fail": "TransformUserClearPasswordFailEvent",
        "success": "TransformUserClearPasswordNextEvent"
      },
      "handlers": {
        "fail": "ResponseHandler",
        "success": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Save the user to the database",
      "type": "SaveNewUserToDb",
      "events": {
        "fail": "SaveNewUserToDbFailEvent",
        "success": "SaveNewUserToDbNextEvent"
      },
      "handlers": {
        "fail": "ResponseHandler",
        "success": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Build the registration emails",
      "type": "BuildEmailTemplates",
      "events": {
        "fail": "BuildEmailTemplatesFailEvent",
        "success": "BuildEmailTemplatesNextEvent"
      },
      "handlers": {
        "fail": "ResponseHandler",
        "success": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Send the registration emails",
      "type": "SendEmails",
      "events": {
        "fail": "SendEmailsFailEvent",
        "success": "SendEmailsFinishEvent"
      },
      "handlers": {
        "fail": "ResponseHandler",
        "success": "ResponseHandler"
      },
      "responders": {
        "fail": "Responder500",
        "success": "Responder201"
      }
    }
  ]
}
