{
  "name": "RegistrationPipeline",
  "components": [
    {
      "desc": "Add registration emails to the context, for later build",
      "type": "AddContextEmails",
      "events": {
        "fail": "AddContextEmailsFailEvent",
        "next": "AddContextEmailsNextEvent"
      },
      "handlers": {
        "fail": "FailHandler",
        "next": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Transform the User viewmodel into the User domain model",
      "type": "TransformViewModelToDomain",
      "events": {
        "fail": "TransformViewModelToDomainFailEvent",
        "next": "TransformViewModelToDomainNextEvent"
      },
      "handlers": {
        "fail": "FailHandler",
        "next": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Ensure that the email is not already in the database",
      "type": "EnforceUniqueUserEmail",
      "events": {
        "fail": "EnforceUniqueUserEmailFailEvent",
        "next": "EnforceUniqueUserEmailNextEvent"
      },
      "handlers": {
        "fail": "FailHandler",
        "next": "NextHandler"
      },
      "responders": {
        "fail": "Responder409"
      }
    },
    {
      "desc": "Convert the user's cleartext password to encrypted",
      "type": "TransformUserClearPassword",
      "events": {
        "fail": "TransformUserClearPasswordFailEvent",
        "next": "TransformUserClearPasswordNextEvent"
      },
      "handlers": {
        "fail": "FailHandler",
        "next": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Save the user to the database",
      "type": "SaveNewUserToDb",
      "events": {
        "fail": "SaveNewUserToDbFailEvent",
        "next": "SaveNewUserToDbNextEvent"
      },
      "handlers": {
        "fail": "FailHandler",
        "next": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Build the registration emails",
      "type": "BuildEmailTemplates",
      "events": {
        "fail": "BuildEmailTemplatesFailEvent",
        "next": "BuildEmailTemplatesNextEvent"
      },
      "handlers": {
        "fail": "FailHandler",
        "next": "NextHandler"
      },
      "responders": {
        "fail": "Responder500"
      }
    },
    {
      "desc": "Send the registration emails",
      "type": "SendEmails",
      "events": {
        "fail": "SendEmailsFailEvent",
        "finish": "SendEmailsFinishEvent"
      },
      "handlers": {
        "fail": "FailHandler",
        "finish": "FinishHandler"
      },
      "responders": {
        "fail": "Responder500",
        "finish": "Responder201"
      }
    }
  ]
}
